import os
import time
import telebot
from openai import OpenAI

# --- –ö–õ–Æ–ß–ò –ò–ó –°–ï–ö–†–ï–¢–û–í ---
GROQ_API_KEY = os.environ.get("GROQ_API_KEY")
TG_BOT_TOKEN = os.environ.get("TG_BOT_TOKEN")

# --- –¢–í–û–ô ID –ö–ê–ù–ê–õ–ê –ò–ó –°–ö–†–ò–ù–®–û–¢–ê ---
CHANNEL_ID = "@loldose777" 

# --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
client = OpenAI(api_key=GROQ_API_KEY, base_url="https://api.groq.com/openai/v1")
bot = telebot.TeleBot(TG_BOT_TOKEN)

# --- –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –ú–û–î–ï–õ–¨ (–ò–ó –¢–í–û–ï–ì–û –°–ö–†–ò–ù–®–û–¢–ê) ---
MODEL = "llama-3.3-70b-versatile"

def generate_joke():
    sys_prompt = (
        "–¢—ã ‚Äî —Ç–æ–ø–æ–≤—ã–π –∞–≤—Ç–æ—Ä —Ä–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ–≥–æ Telegram-–∫–∞–Ω–∞–ª–∞. \n"
        "–ó–∞–¥–∞—á–∞: –ù–∞–ø–∏—Å–∞—Ç—å  —à—É—Ç–∫—É, –∞–Ω–µ–∫–¥–æ—Ç, –ø–∞–Ω—á, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—á–µ—Ç—Å—è –¥–æ—á–∏—Ç–∞—Ç—å –¥–æ –∫–æ–Ω—Ü–∞. \n"
        "–°—Ç–∏–ª—å: –ñ–∏–≤–æ–π, –¥–µ—Ä–∑–∫–∏–π, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞—Ç –¥–ª—è —É—Å–∏–ª–µ–Ω–∏—è –∫–æ–º–∏—á–Ω–æ—Å—Ç–∏, –Ω–æ –Ω–µ —Ü–µ–ª—è—Ö –∑–ª–æ–±—ã –∏–ª–∏ –æ—Å–∫—Ä–±–ª–µ–Ω–∏–π. \n"
        "\n"
        "‚õîÔ∏è –°–¢–†–û–ì–ò–ï –ó–ê–ü–†–ï–¢–´ (–¢–ê–ë–£):\n"
        "1. –ù–ò–ö–ê–ö–û–ô –ü–û–õ–ò–¢–ò–ö–ò, –í–õ–ê–°–¢–ò, –ü–†–ï–ó–ò–î–ï–ù–¢–û–í.\n"
        "2. –ù–ï –¢–†–û–ì–ê–¢–¨ –ê–†–ú–ò–Æ, –°–í–û, –í–ï–¢–ï–†–ê–ù–û–í.\n"
        "3. –ù–ï –¢–†–û–ì–ê–¢–¨ –†–ï–õ–ò–ì–ò–Æ –ò –¶–ï–†–ö–û–í–¨.\n"
        "4. –ë–ï–ó –û–°–ö–û–†–ë–õ–ï–ù–ò–ô –ù–ê–¶–ò–ô.\n"
        "5. –ù–ï –ó–ê–¢–†–ê–ì–ò–í–ê–ô –¢–ï–ú–´, –ó–ê–ü–†–ï–©–ï–ù–ù–´–ï –ó–ê–ö–û–ù–ê–ú–ò –†–û–°–°–ò–ò.\n"
        "–®—É—Ç–∏ –ø—Ä–æ –≤—Å—ë, –∫—Ä–æ–º–µ —Ç–∞–±—É–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–µ–º.\n"
        "\n"
        "–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê (HTML):\n"
        "1. <b>–ö–ª–∏–∫–±–µ–π—Ç–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–¥–æ 70 –∑–Ω–∞–∫–æ–≤)</b>\n"
        "2. –¢–µ–∫—Å—Ç –∞–Ω–µ–∫–¥–æ—Ç–∞ (—Å —ç–º–æ–¥–∑–∏ üåöüî•).\n"
        "3. <tg-spoiler>–ü–∞–Ω—á–ª–∞–π–Ω (—Ä–∞–∑–≤—è–∑–∫–∞)</tg-spoiler>\n"
        "4. –¢—Ä–∏ —Ö–µ—à—Ç–µ–≥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä #—é–º–æ—Ä #–∂–∏–∑–∞)."
    )
    user_prompt = "–ü—Ä–∏–¥—É–º–∞–π —Å–º–µ—à–Ω–æ–π, —Å–≤–µ–∂–∏–π –∞–Ω–µ–∫–¥–æ—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ. –ù–∏–∫–∞–∫–∏—Ö –≤—Å—Ç—É–ø–ª–µ–Ω–∏–π, —Å—Ä–∞–∑—É —Ç–µ–∫—Å—Ç  —à—É—Ç–∫–∏, –∞–Ω–µ–∫–¥–æ—Ç–∞, –ø–∞–Ω—á–∞."

    try:
        print(f"–û—Ç–ø—Ä–∞–≤–ª—è—é –∑–∞–ø—Ä–æ—Å –≤ Groq (–º–æ–¥–µ–ª—å: {MODEL})...")
        response = client.chat.completions.create(
            model=MODEL,
            messages=[{"role": "system", "content": sys_prompt}, {"role": "user", "content": user_prompt}],
            temperature=1.1
        )
        return response.choices[0].message.content
    except Exception as e:
        print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ API: {e}")
        return None

if __name__ == "__main__":
    jokes_sent = 0
    for i in range(2):
        print(f"--- –ê–Ω–µ–∫–¥–æ—Ç ‚Ññ{i+1} ---")
        joke_text = generate_joke()
        if joke_text:
            try:
                bot.send_message(CHANNEL_ID, joke_text, parse_mode="HTML")
                print("‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!")
                jokes_sent += 1
            except Exception as e:
                print(f"‚ùå –û—à–∏–±–∫–∞ Telegram: {e}")
        
        if i == 0:
            time.sleep(10)
    
    if jokes_sent == 0:
        exit(1)
